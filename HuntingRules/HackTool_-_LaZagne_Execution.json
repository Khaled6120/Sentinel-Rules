{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2020-08-01",
      "name": "[concat(parameters('workspace'), '/HackTool_-_LaZagne_Execution')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "eTag": "*",
        "displayName": "HackTool - LaZagne Execution",
        "category": "Hunting Queries",
        "query": "DeviceProcessEvents\n| where FolderPath endswith \"\\\\lazagne.exe\" or ((ProcessCommandLine endswith \".exe all\" or ProcessCommandLine endswith \".exe browsers\" or ProcessCommandLine endswith \".exe chats\" or ProcessCommandLine endswith \".exe databases\" or ProcessCommandLine endswith \".exe games\" or ProcessCommandLine endswith \".exe git\" or ProcessCommandLine endswith \".exe mails\" or ProcessCommandLine endswith \".exe maven\" or ProcessCommandLine endswith \".exe memory\" or ProcessCommandLine endswith \".exe multimedia\" or ProcessCommandLine endswith \".exe sysadmin\" or ProcessCommandLine endswith \".exe unused\" or ProcessCommandLine endswith \".exe wifi\" or ProcessCommandLine endswith \".exe windows\") and (FolderPath contains \":\\\\PerfLogs\\\\\" or FolderPath contains \":\\\\ProgramData\\\\\" or FolderPath contains \":\\\\Temp\\\\\" or FolderPath contains \":\\\\Tmp\\\\\" or FolderPath contains \":\\\\Windows\\\\Temp\\\\\" or FolderPath contains \"\\\\AppData\\\\\" or FolderPath contains \"\\\\Downloads\\\\\" or FolderPath contains \"\\\\Users\\\\Public\\\\\")) or ((ProcessCommandLine contains \"all \" or ProcessCommandLine contains \"browsers \" or ProcessCommandLine contains \"chats \" or ProcessCommandLine contains \"databases \" or ProcessCommandLine contains \"games \" or ProcessCommandLine contains \"git \" or ProcessCommandLine contains \"mails \" or ProcessCommandLine contains \"maven \" or ProcessCommandLine contains \"memory \" or ProcessCommandLine contains \"multimedia \" or ProcessCommandLine contains \"php \" or ProcessCommandLine contains \"svn \" or ProcessCommandLine contains \"sysadmin \" or ProcessCommandLine contains \"unused \" or ProcessCommandLine contains \"wifi \" or ProcessCommandLine contains \"windows \") and (ProcessCommandLine contains \"-oA\" or ProcessCommandLine contains \"-oJ\" or ProcessCommandLine contains \"-oN\" or ProcessCommandLine contains \"-output\" or ProcessCommandLine contains \"-password\" or ProcessCommandLine contains \"-1Password\" or ProcessCommandLine contains \"-apachedirectorystudio\" or ProcessCommandLine contains \"-autologon\" or ProcessCommandLine contains \"-ChromiumBased\" or ProcessCommandLine contains \"-composer\" or ProcessCommandLine contains \"-coreftp\" or ProcessCommandLine contains \"-credfiles\" or ProcessCommandLine contains \"-credman\" or ProcessCommandLine contains \"-cyberduck\" or ProcessCommandLine contains \"-dbvis\" or ProcessCommandLine contains \"-EyeCon\" or ProcessCommandLine contains \"-filezilla\" or ProcessCommandLine contains \"-filezillaserver\" or ProcessCommandLine contains \"-ftpnavigator\" or ProcessCommandLine contains \"-galconfusion\" or ProcessCommandLine contains \"-gitforwindows\" or ProcessCommandLine contains \"-hashdump\" or ProcessCommandLine contains \"-iisapppool\" or ProcessCommandLine contains \"-IISCentralCertP\" or ProcessCommandLine contains \"-kalypsomedia\" or ProcessCommandLine contains \"-keepass\" or ProcessCommandLine contains \"-keepassconfig\" or ProcessCommandLine contains \"-lsa_secrets\" or ProcessCommandLine contains \"-mavenrepositories\" or ProcessCommandLine contains \"-memory_dump\" or ProcessCommandLine contains \"-Mozilla\" or ProcessCommandLine contains \"-mRemoteNG\" or ProcessCommandLine contains \"-mscache\" or ProcessCommandLine contains \"-opensshforwindows\" or ProcessCommandLine contains \"-openvpn\" or ProcessCommandLine contains \"-outlook\" or ProcessCommandLine contains \"-pidgin\" or ProcessCommandLine contains \"-postgresql\" or ProcessCommandLine contains \"-psi-im\" or ProcessCommandLine contains \"-puttycm\" or ProcessCommandLine contains \"-pypykatz\" or ProcessCommandLine contains \"-Rclone\" or ProcessCommandLine contains \"-rdpmanager\" or ProcessCommandLine contains \"-robomongo\" or ProcessCommandLine contains \"-roguestale\" or ProcessCommandLine contains \"-skype\" or ProcessCommandLine contains \"-SQLDeveloper\" or ProcessCommandLine contains \"-squirrel\" or ProcessCommandLine contains \"-tortoise\" or ProcessCommandLine contains \"-turba\" or ProcessCommandLine contains \"-UCBrowser\" or ProcessCommandLine contains \"-unattended\" or ProcessCommandLine contains \"-vault\" or ProcessCommandLine contains \"-vaultfiles\" or ProcessCommandLine contains \"-vnc\" or ProcessCommandLine contains \"-windows\" or ProcessCommandLine contains \"-winscp\" or ProcessCommandLine contains \"-wsl\"))",
        "version": 1,
        "tags": [
          {
            "name": "description",
            "value": "Detects the execution of the LaZagne. A utility used to retrieve multiple types of passwords stored on a local computer.\nLaZagne has been leveraged multiple times by threat actors in order to dump credentials.\n"
          },
          {
            "name": "tactics",
            "value": "Credential Access"
          }
        ]
      }
    }
  ]
}
