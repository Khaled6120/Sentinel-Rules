name: File And SubFolder Enumeration Via Dir Command
id: 7c9340a9-e2ee-4e43-94c5-c54ebbea1006
author: frack113
date: 2021/12/13
level: low
description: 'Detects usage of the "dir" command part of Widows CMD with the "/S"
  command line flag in order to enumerate files in a specified directory and all subdirectories.

  '
status: test
modified: 2024/04/14
logsource:
  category: process_creation
  product: windows
tactics:
- discovery
relevantTechniques:
- t1217
query: 'DeviceProcessEvents

  | where (ProcessCommandLine =~ "*dir*-s*" or ProcessCommandLine =~ "*dir*/s*") and
  (FolderPath endswith "\\cmd.exe" or ProcessVersionInfoOriginalFileName =~ "Cmd.Exe")'
