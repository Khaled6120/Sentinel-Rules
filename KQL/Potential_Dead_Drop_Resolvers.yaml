name: Potential Dead Drop Resolvers
id: 297ae038-edc2-4b2e-bb3e-7c5fc94dd5c7
author: Sorina Ionescu, X__Junior (Nextron Systems)
date: 2022/08/17
severity: high
description: 'Detects an executable, which is not an internet browser or known application,
  initiating network connections to legit popular websites, which were seen to be
  used as dead drop resolvers in previous attacks.

  In this context attackers leverage known websites such as "facebook", "youtube",
  etc. In order to pass through undetected.

  '
status: test
modified: 2024/02/06
logsource:
  category: network_connection
  product: windows
tactics:
- Command And Control
relevantTechniques:
- T1102
query: 'DeviceNetworkEvents

  | where (RemoteUrl endswith ".t.me" or RemoteUrl endswith "4shared.com" or RemoteUrl
  endswith "anonfiles.com" or RemoteUrl endswith "cdn.discordapp.com" or RemoteUrl
  endswith "cloudflare.com" or RemoteUrl endswith "ddns.net" or RemoteUrl endswith
  "discord.com" or RemoteUrl endswith "docs.google.com" or RemoteUrl endswith "drive.google.com"
  or RemoteUrl endswith "dropbox.com" or RemoteUrl endswith "dropmefiles.com" or RemoteUrl
  endswith "facebook.com" or RemoteUrl endswith "feeds.rapidfeeds.com" or RemoteUrl
  endswith "fotolog.com" or RemoteUrl endswith "ghostbin.co/" or RemoteUrl endswith
  "githubusercontent.com" or RemoteUrl endswith "gofile.io" or RemoteUrl endswith
  "hastebin.com" or RemoteUrl endswith "imgur.com" or RemoteUrl endswith "livejournal.com"
  or RemoteUrl endswith "mediafire.com" or RemoteUrl endswith "mega.co.nz" or RemoteUrl
  endswith "mega.nz" or RemoteUrl endswith "onedrive.com" or RemoteUrl endswith "paste.ee"
  or RemoteUrl endswith "pastebin.com" or RemoteUrl endswith "pastebin.pl" or RemoteUrl
  endswith "pastetext.net" or RemoteUrl endswith "privatlab.com" or RemoteUrl endswith
  "privatlab.net" or RemoteUrl endswith "reddit.com" or RemoteUrl endswith "send.exploit.in"
  or RemoteUrl endswith "sendspace.com" or RemoteUrl endswith "steamcommunity.com"
  or RemoteUrl endswith "storage.googleapis.com" or RemoteUrl endswith "technet.microsoft.com"
  or RemoteUrl endswith "temp.sh" or RemoteUrl endswith "transfer.sh" or RemoteUrl
  endswith "twitter.com" or RemoteUrl endswith "ufile.io" or RemoteUrl endswith "abuse.ch"
  or RemoteUrl endswith "vimeo.com" or RemoteUrl endswith "wetransfer.com" or RemoteUrl
  endswith "youtube.com") and (not(((InitiatingProcessFolderPath endswith "\\avant.exe"
  and (InitiatingProcessFolderPath startswith "C:\\Program Files (x86)\\Avant Browser\\"
  or InitiatingProcessFolderPath startswith "C:\\Program Files\\Avant Browser\\"))
  or (InitiatingProcessFolderPath endswith "\\brave.exe" and InitiatingProcessFolderPath
  startswith "C:\\Program Files\\BraveSoftware\\") or (InitiatingProcessFolderPath
  in~ ("C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe", "C:\\Program
  Files (x86)\\Google\\Chrome\\Application\\chrome.exe")) or (InitiatingProcessFolderPath
  endswith "\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe" and InitiatingProcessFolderPath
  startswith "C:\\Users\\") or ((InitiatingProcessFolderPath contains "C:\\Program
  Files\\Windows Defender Advanced Threat Protection\\" or InitiatingProcessFolderPath
  contains "C:\\Program Files\\Windows Defender\\" or InitiatingProcessFolderPath
  contains "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\") and (InitiatingProcessFolderPath
  endswith "\\MsMpEng.exe" or InitiatingProcessFolderPath endswith "\\MsSense.exe"))
  or ((RemoteUrl endswith "discord.com" or RemoteUrl endswith "cdn.discordapp.com")
  and InitiatingProcessFolderPath contains "\\AppData\\Local\\Discord\\" and InitiatingProcessFolderPath
  endswith "\\Discord.exe") or (RemoteUrl endswith "dropbox.com" and (InitiatingProcessFolderPath
  endswith "\\Dropbox.exe" or InitiatingProcessFolderPath endswith "\\DropboxInstaller.exe")
  and (InitiatingProcessFolderPath startswith "C:\\Program Files (x86)\\Dropbox\\Client\\"
  or InitiatingProcessFolderPath startswith "C:\\Program Files\\Dropbox\\Client\\"))
  or (InitiatingProcessFolderPath startswith "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\"
  or InitiatingProcessFolderPath endswith "\\WindowsApps\\MicrosoftEdge.exe" or (InitiatingProcessFolderPath
  in~ ("C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe", "C:\\Program
  Files\\Microsoft\\Edge\\Application\\msedge.exe"))) or ((InitiatingProcessFolderPath
  endswith "\\msedge.exe" or InitiatingProcessFolderPath endswith "\\msedgewebview2.exe")
  and (InitiatingProcessFolderPath startswith "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\"
  or InitiatingProcessFolderPath startswith "C:\\Program Files\\Microsoft\\EdgeCore\\"))
  or (InitiatingProcessFolderPath endswith "\\falkon.exe" and (InitiatingProcessFolderPath
  startswith "C:\\Program Files\\Falkon\\" or InitiatingProcessFolderPath startswith
  "C:\\Program Files (x86)\\Falkon\\")) or (InitiatingProcessFolderPath in~ ("C:\\Program
  Files\\Mozilla Firefox\\firefox.exe", "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"))
  or (InitiatingProcessFolderPath endswith "\\AppData\\Local\\Mozilla Firefox\\firefox.exe"
  and InitiatingProcessFolderPath startswith "C:\\Users\\") or (InitiatingProcessFolderPath
  contains "\\AppData\\Local\\Flock\\" and InitiatingProcessFolderPath endswith "\\Flock.exe")
  or (RemoteUrl endswith "drive.google.com" and (InitiatingProcessFolderPath contains
  "C:\\Program Files\\Google\\Drive File Stream\\" or InitiatingProcessFolderPath
  contains "C:\\Program Files (x86)\\Google\\Drive File Stream\\") and InitiatingProcessFolderPath
  endswith "GoogleDriveFS.exe") or (InitiatingProcessFolderPath in~ ("C:\\Program
  Files (x86)\\Internet Explorer\\iexplore.exe", "C:\\Program Files\\Internet Explorer\\iexplore.exe"))
  or (InitiatingProcessFolderPath contains "\\AppData\\Local\\Maxthon\\" and InitiatingProcessFolderPath
  endswith "\\maxthon.exe") or ((RemoteUrl endswith "mega.co.nz" or RemoteUrl endswith
  "mega.nz") and (InitiatingProcessFolderPath endswith "\\MEGAsync.exe" or (InitiatingProcessFolderPath
  contains "\\MEGAsyncSetup32_" and InitiatingProcessFolderPath contains "RC.exe")
  or InitiatingProcessFolderPath endswith "\\MEGAsyncSetup32.exe" or InitiatingProcessFolderPath
  endswith "\\MEGAsyncSetup64.exe" or InitiatingProcessFolderPath endswith "\\MEGAupdater.exe"))
  or (InitiatingProcessFolderPath contains "\\AppData\\Local\\Programs\\midori-ng\\"
  and InitiatingProcessFolderPath endswith "\\Midori Next Generation.exe") or (RemoteUrl
  endswith "onedrive.com" and InitiatingProcessFolderPath contains "\\AppData\\Local\\Microsoft\\OneDrive\\"
  and InitiatingProcessFolderPath endswith "\\OneDrive.exe") or (InitiatingProcessFolderPath
  contains "\\AppData\\Local\\Programs\\Opera\\" and InitiatingProcessFolderPath endswith
  "\\opera.exe") or (InitiatingProcessFolderPath contains "\\AppData\\Local\\Phoebe\\"
  and InitiatingProcessFolderPath endswith "\\Phoebe.exe") or (InitiatingProcessFolderPath
  endswith "C:\\Program Files (x86)\\PRTG Network Monitor\\PRTG Probe.exe" or InitiatingProcessFolderPath
  endswith "C:\\Program Files\\PRTG Network Monitor\\PRTG Probe.exe") or (InitiatingProcessFolderPath
  endswith "\\QtWeb.exe" and (InitiatingProcessFolderPath startswith "C:\\Program
  Files (x86)\\QtWeb\\" or InitiatingProcessFolderPath startswith "C:\\Program Files\\QtWeb\\"))
  or ((InitiatingProcessFolderPath contains "C:\\Program Files (x86)\\Safari\\" or
  InitiatingProcessFolderPath contains "C:\\Program Files\\Safari\\") and InitiatingProcessFolderPath
  endswith "\\safari.exe") or (InitiatingProcessFolderPath endswith "\\seamonkey.exe"
  and (InitiatingProcessFolderPath startswith "C:\\Program Files\\SeaMonkey\\" or
  InitiatingProcessFolderPath startswith "C:\\Program Files (x86)\\SeaMonkey\\"))
  or (InitiatingProcessFolderPath endswith "\\slimbrowser.exe" and (InitiatingProcessFolderPath
  startswith "C:\\Program Files\\SlimBrowser\\" or InitiatingProcessFolderPath startswith
  "C:\\Program Files (x86)\\SlimBrowser\\")) or (RemoteUrl endswith ".t.me" and InitiatingProcessFolderPath
  contains "\\AppData\\Roaming\\Telegram Desktop\\" and InitiatingProcessFolderPath
  endswith "\\Telegram.exe") or (InitiatingProcessFolderPath contains "\\AppData\\Local\\Vivaldi\\"
  and InitiatingProcessFolderPath endswith "\\vivaldi.exe") or (InitiatingProcessFolderPath
  endswith "\\whale.exe" and (InitiatingProcessFolderPath startswith "C:\\Program
  Files\\Naver\\Naver Whale\\" or InitiatingProcessFolderPath startswith "C:\\Program
  Files (x86)\\Naver\\Naver Whale\\")) or (InitiatingProcessFolderPath endswith "\\Waterfox.exe"
  and (InitiatingProcessFolderPath startswith "C:\\Program Files\\Waterfox\\" or InitiatingProcessFolderPath
  startswith "C:\\Program Files (x86)\\Waterfox\\")) or (RemoteUrl endswith "facebook.com"
  and InitiatingProcessFolderPath endswith "\\WhatsApp.exe" and (InitiatingProcessFolderPath
  startswith "C:\\Program Files (x86)\\WindowsApps\\" or InitiatingProcessFolderPath
  startswith "C:\\Program Files\\WindowsApps\\")))))'
eventGroupingSettings:
  aggregationKind: SingleAlert
queryFrequency: P1D
queryPeriod: P1D
enabled: true
entityMappings: null
sentinelEntitiesMappings: null
triggerThreshold: 0
suppressionDuration: PT5H
suppressionEnabled: false
triggerOperator: GreaterThan
kind: Scheduled
